<?php
class WP_Update{

	function search($item='themes',$tags=array(),$output='array',$offset=0,$limit=15){
		if('themes' == $item){
			if(0 == count($tags)) return false; //Must specify search terms.
			if('array' == $output) return $this->searchThemes($tags,$offset,$limit);
			if('html' == $output){ //Format it for HTML output.
				$items = $this->searchThemes($tags,$offset,$limit);
				return var_export($items,true);
			}
			//Format for.. JSSI? XML?
			return;
		} elseif('plugins' == $item){
			
		}
	}
	function searchThemes($tags, $offset, $limit){
		return unserialize('a:16:{i:0;a:7:{s:4:"name";s:17:"Coffee Chick  1.0";s:3:"url";s:67:"http://themes.wordpress.net/columns/2-columns/2106/coffee-chick-10/";s:2:"id";s:4:"2106";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2106";s:13:"downloadcount";s:1:"2";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2106-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2106-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2106-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2106";}i:1;a:7:{s:4:"name";s:10:"Angel  1.1";s:3:"url";s:60:"http://themes.wordpress.net/columns/2-columns/2105/angel-11/";s:2:"id";s:4:"2105";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2105";s:13:"downloadcount";s:1:"9";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2105-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2105-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2105-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2105";}i:2;a:7:{s:4:"name";s:17:"Red Business  1.1";s:3:"url";s:67:"http://themes.wordpress.net/columns/2-columns/2104/red-business-11/";s:2:"id";s:4:"2104";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2104";s:13:"downloadcount";s:2:"14";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2104-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2104-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2104-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2104";}i:3;a:7:{s:4:"name";s:24:"Peterandrej04_green  1.0";s:3:"url";s:74:"http://themes.wordpress.net/columns/3-columns/2103/peterandrej04_green-10/";s:2:"id";s:4:"2103";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2103";s:13:"downloadcount";s:2:"36";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2103-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2103-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2103-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2103";}i:4;a:7:{s:4:"name";s:14:"Wordpress Blue";s:3:"url";s:66:"http://themes.wordpress.net/columns/2-columns/2102/wordpress-blue/";s:2:"id";s:4:"2102";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2102";s:13:"downloadcount";s:2:"21";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2102-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2102-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2102-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2102";}i:5;a:7:{s:4:"name";s:20:"Wordpress Black Wolf";s:3:"url";s:72:"http://themes.wordpress.net/columns/2-columns/2101/wordpress-black-wolf/";s:2:"id";s:4:"2101";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2101";s:13:"downloadcount";s:2:"39";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2101-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2101-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2101-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2101";}i:6;a:7:{s:4:"name";s:22:"WordPress Classic  1.5";s:3:"url";s:72:"http://themes.wordpress.net/columns/2-columns/2100/wordpress-classic-15/";s:2:"id";s:4:"2100";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2100";s:13:"downloadcount";s:2:"52";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2100-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2100-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2100-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2100";}i:7;a:7:{s:4:"name";s:17:"MountainMist  1.0";s:3:"url";s:67:"http://themes.wordpress.net/columns/2-columns/2099/mountainmist-10/";s:2:"id";s:4:"2099";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2099";s:13:"downloadcount";s:2:"56";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2099-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2099-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2099-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2099";}i:8;a:7:{s:4:"name";s:5:"Sleek";s:3:"url";s:57:"http://themes.wordpress.net/columns/2-columns/2098/sleek/";s:2:"id";s:4:"2098";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2098";s:13:"downloadcount";s:2:"70";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2098-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2098-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2098-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2098";}i:9;a:7:{s:4:"name";s:14:"AqueousWP  1.0";s:3:"url";s:64:"http://themes.wordpress.net/columns/3-columns/2097/aqueouswp-10/";s:2:"id";s:4:"2097";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2097";s:13:"downloadcount";s:2:"72";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2097-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2097-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2097-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2097";}i:10;a:7:{s:4:"name";s:24:"RockinLetterhead Blue  1";s:3:"url";s:75:"http://themes.wordpress.net/columns/2-columns/2096/rockinletterhead-blue-1/";s:2:"id";s:4:"2096";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2096";s:13:"downloadcount";s:2:"61";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2096-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2096-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2096-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2096";}i:11;a:7:{s:4:"name";s:19:"Ornate-3column  1.1";s:3:"url";s:69:"http://themes.wordpress.net/columns/3-columns/2095/ornate-3column-11/";s:2:"id";s:4:"2095";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2095";s:13:"downloadcount";s:2:"44";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2095-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2095-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2095-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2095";}i:12;a:7:{s:4:"name";s:11:"Ornate  1.1";s:3:"url";s:61:"http://themes.wordpress.net/columns/2-columns/2094/ornate-11/";s:2:"id";s:4:"2094";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2094";s:13:"downloadcount";s:2:"52";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2094-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2094-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2094-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2094";}i:13;a:7:{s:4:"name";s:13:"Freeeze!  1.0";s:3:"url";s:62:"http://themes.wordpress.net/columns/2-columns/2093/freeeze-10/";s:2:"id";s:4:"2093";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2093";s:13:"downloadcount";s:2:"35";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2093-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2093-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2093-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2093";}i:14;a:7:{s:4:"name";s:14:"BlueBreak  1.0";s:3:"url";s:63:"http://themes.wordpress.net/columns/1-column/2092/bluebreak-10/";s:2:"id";s:4:"2092";s:8:"download";s:51:"http://themes.wordpress.net/download.php?theme=2092";s:13:"downloadcount";s:2:"38";s:8:"snapshot";a:3:{s:5:"thumb";s:52:"http://themes.wordpress.net/snapshots/2092-thumb.jpg";s:6:"medium";s:53:"http://themes.wordpress.net/snapshots/2092-medium.jpg";s:3:"big";s:50:"http://themes.wordpress.net/snapshots/2092-big.jpg";}s:7:"testrun";s:49:"http://themes.wordpress.net/testrun/?wptheme=2092";}i:15;a:7:{s:4:"name";N;s:3:"url";N;s:2:"id";N;s:8:"download";s:47:"http://themes.wordpress.net/download.php?theme=";s:13:"downloadcount";N;s:8:"snapshot";a:3:{s:5:"thumb";s:48:"http://themes.wordpress.net/snapshots/-thumb.jpg";s:6:"medium";s:49:"http://themes.wordpress.net/snapshots/-medium.jpg";s:3:"big";s:46:"http://themes.wordpress.net/snapshots/-big.jpg";}s:7:"testrun";s:45:"http://themes.wordpress.net/testrun/?wptheme=";}}');
		
		require_once( ABSPATH . 'wp-includes/class-snoopy.php');
		$snoopy = new Snoopy();
		$snoopy->submit("http://themes.wordpress.net/",$_POST);
		return $this->parseThemeHTML($snoopy->results);
	}
	function parseThemeHTML($html){
		preg_match_all('#<a href="(.*?)" rel="bookmark" title="(.*?)"><img src="/snapshots/(\d+?)-thumb.jpg" alt="\2" /></a>#i',$html,$mat1);
		preg_match_all('#Download \((\d+)\)#i',$html,$mat2);
		$ret = array();
		
		$totalItems = count($mat2[1]);
		for($i=0;$i<$totalItems;$i++){
			$id = $mat1[3][$i];
			$ret[] = array(
							'name'=>$mat1[2][$i],
							'url'=>$mat1[1][$i],
							'id'=>$id,
							'download'=>'http://themes.wordpress.net/download.php?theme='.$id,
							'downloadcount'=>$mat2[1][$i],
							'snapshot'=> array(
										'thumb'=>'http://themes.wordpress.net/snapshots/'.$id.'-thumb.jpg',
										'medium'=>'http://themes.wordpress.net/snapshots/'.$id.'-medium.jpg',
										'big'=>'http://themes.wordpress.net/snapshots/'.$id.'-big.jpg'
										),
							'testrun'=>'http://themes.wordpress.net/testrun/?wptheme='.$id
							);
		}
		return $ret;
	}
}
?>